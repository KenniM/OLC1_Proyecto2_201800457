<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROYECTO2_201800457</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/vtree.css" type="text/css"/>

<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="/dist/vtree.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script>
    <style type="text/css" media="screen">
        #editor1 { 
            position: relative;
            
            height: 225px;
            max-height: 225px;
            overflow: hidden;
        }
        #salidaJS { 
            position: relative;
            
            height: 180px;
            max-height: 180px;
            overflow: hidden;
        }
        #salidaPy { 
            position: relative;
            
            height: 180px;
            max-height: 180px;
            overflow: hidden;
        }
    </style>
    
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <a class="navbar-brand" href="#">Traductor</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
      
        <div class="collapse navbar-collapse" id="navbarColor01">
          <ul class="navbar-nav mr-auto">
            <li class="dropdown">
              <a class="nav-link dropdown-toggle active" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Archivo</a>
              <div class="dropdown-menu">
                <h6 class="dropdown-header">Entradas</h6>
                <a class="dropdown-item" href="#" onclick="addTab(1)">Nueva pestaña</a>
                <a class="dropdown-item" href="#">Abrir archivo...
                  <input id="fileInput" type="file" accept=".java">
                </a>
                <a class="dropdown-item" href="#" onclick="saveEntryFile()">Guardar entrada actual</a>
                <div class="dropdown-divider"></div>
                <h6 class="dropdown-header">Salidas</h6>
                <a class="dropdown-item" href="#" onclick="saveJSOutput()">Guardar salida de JavaScript</a>
                <a class="dropdown-item" href="#" onclick="savePyOutput()">Guardar salida de Python</a>
                <a class="dropdown-item" href="#" onclick="saveBoth()">Guardar ambas salidas</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#" onclick="Conn()">Analizar <span class="sr-only">(current)</span></a>
                </li>
          </ul>
          <span class="navbar-text">
            Kenni Martínez - 201800457
          </span>
        </div>
      </nav>
      <ul class="nav nav-tabs" id="pestaniasT">
        <li class="nav-item">
          <a id="Pestaña1"class="nav-link active" data-toggle="tab" href="#home" onclick="changeTab(1)">Pestaña 1</a>
        </li>
      </ul>
     
      <div class="container">
        <div class="row">
          <div class="col">Entrada en Java</div>
          <div class="w-100"></div>
      <div id="editor1" class="col">public class Myclase { 
    
        String variable, variable1,variable2;
        int constante=100/5*5/5+3+2-1*0+1;
    
      
       public void MyMetodo(){
          String nombre="myMetodo";
          int x , y;
          x=10;
          y=11;
          int variable=3+3-5/5*10;
          System.out.println("myMetodo");
          System.out.print(x);
      }
      public void MyMetodo2(int x){
          int valor=x;
          System.out.println(x);
          for(int f; x<=f; f++){
              System.out.println("HOla");
          }
          
         //hola
      }
    
      public void Contador(){
            int contador = 0 ;
            do{
                System.out.println ("Contador" + (contador + 1) );
                contador ++;
            } while (contador<10);
             
              System.out.println(contador + "va aumentando");
        }
    
        public static void main(String [] args ){
          
          System.out.println("ESTE ES EL MAIN");
        } 
    
    public void testif(String valor){
            int contador = valor ;
            if(valor==10){
                //imprime
                for(int f; x<=f; f++){
                    System.out.println(f);
                }
            } else if (valor>10){
                
                System.out.println("x");
            
            }else{
                System.out.println("x");
            }
            
      }
    
    }</div>
  </div>
  <br>
  <div class="row">
    <div class="col">Salida en JavaScript</div>
    <div class="col">Salida en Python</div>
    <div class="w-100"></div>
    <div id="salidaJS" class="col">
      /*La salida en el lenguaje JS se mostrará aquí*/
    </div>
    <div id="salidaPy" class="col">
      '''La salida en el lenguaje Python se mostrará aquí'''
    </div>

  </div>
  <br>
  <!-- Button trigger modal -->
<button type="button" class="btn btn-primary" onclick="verTokens()">
  Ver lista de Tokens
</button>
<button type="button" class="btn btn-primary" onclick="verAst()" data-toggle="collapse" data-target="#container2" aria-expanded="false" aria-controls="container2">
  Ver AST
</button>
<style>
  @media screen and (min-width: 676px) {
      .modal-dialog {
        max-width: 900px; /* New width for default modal */
      }
  }
</style>
<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header bg-primary">
        <h5 class="modal-title text-white" id="exampleModalLabel">Lista de Tokens</h5>
        <button type="button" class="close btn-danger text-white" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id="ContenidoMsg">
        ...
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>
  </div>
  <center>
  <div class="collapse" id="container2"></div>
</center>
    <script src="./js/jquery.min.js"></script>
    <script src="/js/pageLogic.js" type="text/javascript" charset="utf-8"></script>
      <script src="/js/src/ace.js" type="text/javascript" charset="utf-8"></script>
      <script>
        var bodyMsg=document.getElementById("ContenidoMsg");
        var tituloMsg=document.getElementById("exampleModalLabel");
        var editor = ace.edit("editor1");
        editor.setTheme("ace/theme/monokai");
        editor.session.setMode("ace/mode/java");
        editor.setOptions({
            autoScrollEditorIntoView: false,
            copyWithEmptySelection: true,
        });

        var salJS = ace.edit("salidaJS");
        var beautify = ace.require("ace/ext/beautify"); // get reference to extension
        salJS.setTheme("ace/theme/monokai");
        salJS.session.setMode("ace/mode/javascript");
        salJS.setOptions({
            autoScrollEditorIntoView: false,
            copyWithEmptySelection: true,
        });
        salJS.setReadOnly(true);

        var salPy = ace.edit("salidaPy");
        salPy.setTheme("ace/theme/monokai");
        salPy.session.setMode("ace/mode/python");
        salPy.setOptions({
            autoScrollEditorIntoView: false,
            copyWithEmptySelection: true,
        });
        salPy.setReadOnly(true);

        let errorsArray = [];


        var vt;
  function updateTree(contenido) {

var container = document.getElementById("container2");
vt = new VTree(container);
var reader = new VTree.reader.Object();

    try {
      var jsonData = JSON.parse(contenido);
    } catch (e) {
      bodyMsg.innerHTML = 'JSON parse error: ' + e.message;
    }

    var data = reader.read(jsonData);

    vt.data(data)
      .update();
  }

  


        function verAst(){
          var getAst='http://localhost:8080/GetAST/';
          var dataAsJson={
            input:editor.getValue()
          };
          $.post(getAst,dataAsJson,function(data,status){
            if (data.length!=0){
              /*tituloMsg.innerHTML='Visor del AST';
              bodyMsg.innerHTML='';*/
              document.getElementById("container2").innerHTML="";
              let stringJson=JSON.stringify(data,null,2);
              updateTree(stringJson);
            }
          })
        }

        function verTokens(){
          
    var getTokens = 'http://localhost:8080/GetTokens/';
    var dataAsJson = {
        input: editor.getValue()
    };
    $.post(getTokens, dataAsJson, function (data, status) {
        if (data.length != 0) {
          tituloMsg.innerHTML="Lista de Tokens";
          let contenidoTokens=data;
          bodyMsg.innerHTML='';
          bodyMsg.innerHTML='<table class="table table-hover">'+
  '<thead class="thead-dark">'+
    '<tr>'+
      '<th scope="col">#</th>'+
      '<th scope="col">Fila</th>'+
      '<th scope="col">Columna</th>'+
      '<th scope="col">Token</th>'+
      '<th scope="col">Lexema</th>'+
    '</tr>'+
  '</thead>'+
  '<tbody>'+contenidoTokens+'</tbody>'+
'</table>';
$("#exampleModal").modal();
        }
        else {
          tituloMsg.innerHTML="Sin Tokens";
          bodyMsg.innerHTML="No se ha obtenido un listado de Tokens. ¿El archivo se encuentra vacío?";
          $("#exampleModal").modal();
        }
    });
  
  
  
         
} 
function Conn() {

    var url = 'http://localhost:8080/Analizar/';
    var urlT = 'http://localhost:8080/Traducir/';
    var urlE = 'http://localhost:8080/GetErrores/';

    var dataAsJson = {
        input: editor.getValue()
    };

    $.post(url, dataAsJson, function (data, status) {
      console.log("ANALASIS");
        console.log(status);
        if (data.length == 0) {
          tituloMsg.innerHTML="Análisis finalizado";
          bodyMsg.innerHTML="No se han encontrado errores, revise la traducción obtenida en la salida.";
          $("#exampleModal").modal();
            console.log("TRADUCCION");
            $.post(urlT,dataAsJson,function(data1,status1){
              console.log(status1);
              if(data1.length!=0){
                salJS.setValue(data1);
                salJS.getSession().setValue(js_beautify(salJS.getValue(), {
        indent_size: 2
    }));
              }
            })
        }
        else {
          tituloMsg.innerHTML="Análisis finalizado con errores";
          $.post(urlE,dataAsJson,function(data5,status1){
              console.log(status1);
              let contenidoErrores=data5;
          bodyMsg.innerHTML='';
          bodyMsg.innerHTML='<table class="table table-hover">'+
  '<thead class="thead-dark">'+
    '<tr>'+
      '<th scope="col">#</th>'+
      '<th scope="col">Tipo de Errror</th>'+
      '<th scope="col">Fila</th>'+
      '<th scope="col">Columna</th>'+
      '<th scope="col">Descripción</th>'+
    '</tr>'+
  '</thead>'+
  '<tbody>'+contenidoErrores+'</tbody>'+
'</table>';
$("#exampleModal").modal();
            })
            salJS.setValue(data);
        }
    });

    
}
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.7.5/beautify.min.js"
    integrity="sha256-z3YWAUWq4ZqhJwjqxdTFwmXUOkEPpQUpdxWHCZVADA4=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.7.5/beautify-css.min.js"
    integrity="sha256-j7ahmt6lLS5KOhBLZUivk4/awJlkM8eDP/CYbrCDqRA=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>
</body>
</html>